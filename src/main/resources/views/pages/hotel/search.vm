#parse("_fragments/_search-form-modify.vm")
<!-- BREADCRUMB -->
<section class="breadcrumb-wrapper">
    <div class="container">
        <ol class="breadcrumb">
            <li><a href="/">Home</a></li>
            <li><a href="#">$requestParam.getParameter("nationality")</a></li>
            <li class="active"><a href="#">$requestParam.getParameter("cityTitle")</a></li>
        </ol>
    </div>
</section>
#if($isResult)
    #set($title = "Search Result")
    <div class="space-xs pt0">
    <div class="container">
        <div id="main-contents" class="sideleft">
            #parse("pages/hotel/_filter.vm")
            <!-- Main contents -->
            <div id="main">
                <hr class="break break30">
                <ul class="filter">
                    <li><span class="filter-label">Sort by:</span></li>
                    <li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown">Price <span class="caret"></span></a>
                        <ul class="dropdown-menu">
                            <li><a href="#" class="sortprice" data-sortprice="ascend">Lowest prices</a></li>
                            <li><a href="#" class="sortprice" data-sortprice="decend">Highest prices</a></li>
                        </ul>
                    </li>
##                    <li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown">Star<span class="caret"></span></a>
##                        <ul class="dropdown-menu">
##                            #foreach($starRating in $starRatings)
##                                <li>
##                                    <label><div class="rate rate-sm rate-filter" data-starrating="$starRating"><span class="rate$starRating"></span></div> stars ($starRatingCounts.get($starRating))</label>
##                                </li>
##                            #end
##                            #foreach($starRating in $starRatings)
##                                <li><a href="#" class="xhr-sort-pricerate"><div data-rating="$starRating" class="rate rate-sm"><span class="rate$starRating"></span></div> $starRating star#if($starRating > 1)s#end</a></li>
##                            #end
##                        </ul>
##                    </li>
                </ul>

                <ul class="items">
                    #foreach($availabilities in $searchResponse.hotelAvailabilities)
                        #set($hotel = $availabilities.hotel)
                        #set($rating = $hotel.starRating/10.0)
                        #set($starrating=$math.round($rating))
                        <li class="item clearfix" data-hotelname="$hotel.hotelName" data-starrating="$starrating" data-lowestrate="$availabilities.lowestRate" data-reviewscore="$hotel.score">
                            <figure>
                                <a href="/hotel/detail?hotelId=$hotel.hotelId&queryId=$queryId"><img src="${pictureUrl}$hotel.pictureId"  style="min-height: 231px;" alt="$hotel.hotelName"></a>
                            </figure>
                            <hgroup>
                                <div class="item-header">
                                    <div class="item-header-title">
                                        <div class="item-header-rates">
                                            <div class="item-header-score">
                                                #set($scoreInt=$hotel.score/10.0)
                                                #if($hotel.score >= 90)
                                                    Wonderful $scoreInt
                                                #elseif($hotel.score >= 80)
                                                    Very good $scoreInt
                                                #elseif($hotel.score >= 70)
                                                    Good $scoreInt
                                                #elseif($hotel.score > 60)
                                                    Pleasant $scoreInt
                                                #else

                                                #end
                                            </div>
                                            <div class="item-header-reviews">$hotel.reviews review#if($hotel.reviews > 1)s#end</div>
                                        </div>
                                        <a href="/hotel/detail?hotelId=$hotel.hotelId&queryId=$queryId">$hotel.hotelName</a>
                                        <div class="rate"><span class="rate$starrating"></span></div>
                                    </div>
                                    #if($hotel.address)
                                        <div class="item-header-meta">$hotel.address</div>
                                    #end
                                </div>
                                <div class="item-options">
                                    <div class="item-option room-avail item-option-heading">
                                        <div class="item-option-roomtype">Room Type</div>
                                        <div class="item-option-breakfast">Breakfast</div>
                                        <div class="item-option-policy">Policy</div>
                                        <div class="item-option-price">Price</div>
                                        <div class="item-option-action"></div>
                                    </div>
                                    <div class="room-avail">
                                        #set($verifyrequests = $!hotelVerifyRequests.get($hotel.hotelId))
                                        #set($policyrequests = $!hotelPolicyRequests.get($hotel.hotelId))
                                        #set($i = 0)
                                        #foreach($availability in $availabilities.availabilities)
                                            <div class="item-option">
                                                <div class="item-option-roomtype">
                                                    #foreach($room in $availability.hotelRooms.rooms)
                                                        <div class="roomtype-name">$room.roomName<!--$room.roomType--></div>
                                                    #end
                                                </div>
                                                <div class="item-option-breakfast">
                                                    #if($availability.hotelRooms.meal.breakfastDescription != "")
                                                        $availability.hotelRooms.meal.breakfastDescription
                                                    #elseif($availability.hotelRooms.meal.mealDescription != "")
                                                        $availability.hotelRooms.meal.mealDescription
                                                    #elseif($availability.hotelRooms.meal.breakfast == "true")
                                                        Available
                                                    #else
                                                        No Breakfast
                                                    #end
                                                </div>
                                                <div class="item-option-policy">
                                                    #if($availability.hotelRooms.policies.policies)
                                                        <!--<a href="#" class="text-blue view-policy" data-request='$policyRequests.get($i)'>View Policy</a>-->
                                                        <div class="room-policy">Free Cancellation<span class="ico ico-question-circle-purple" data-toggle="tooltip" title="" data-original-title="Free cancellation can be made before 2017-05-04T23:59:59"></span></div>
                                                    #else
                                                        <a href="javascript:void(0);" class="text-blue xhrGetPolicy" data-request='$policyrequests.get($i)'>View Policy</a>
                                                    #end
                                                </div>
                                                <div class="item-option-price">
                                                    #if($formatter.getPercentage($availability.totalRate, $availability.totalOriginalRate) > 0)
                                                    <div class="price-discount">
                                                        <div class="price-discount-percentage">$formatter.getPercentage($availability.totalRate, $availability.totalOriginalRate)%</div>
                                                        <div class="price-discount-amount">$formatter.getCurrency($availability.currency) $formatter.subtractDiscount($availability.totalRate, $availability.totalOriginalRate)</div>
                                                    </div>
                                                    #end
                                                    <div class="price-amount">
                                                        <div class="price-amount-value">$formatter.getCurrency($availability.currency) $availability.totalRate
                                                        <!--<span class="ico ico-question-circle" data-toggle="tooltip" title="Get Price Break Down"></span>--></div>
                                                        <!--<div class="price-amount-notes">Rooms per night</div>-->
                                                        <div class="price-amount-notes">Total rate</div>
                                                    </div>
                                                </div>
                                                <div class="item-option-action">
                                                    #set($rateIds = "")
                                                    #foreach($room in $availability.hotelRooms.rooms)
                                                        #set($rateIds = $rateIds + " " + $room.roomRateId)
                                                    #end
                                                    <a href="#" class="booknow" data-hotelid="$availability.hotelId" data-request='$verifyrequests.get($i)' data-queryid="$queryId">BOOK NOW<span class="ico ico-arrow-right-sm"></span></a>
                                                </div>
                                            </div>
                                            #set($i = $i + 1)
                                        #end
                                    </div>
                                </div>
                                <div class="item-footer">
                                    <a href="/hotel/detail?hotelId=$hotel.hotelId" class="seeall">SEE ALL ROOM OPTIONS</a> <!-- data-hotelid="$hotel.hotelId" onclick="javascript: xhrRoomVerifyHref($hotel.hotelId); return false;" -->
                                </div>
                            </hgroup>
                        </li>
                    #end
                </ul>

                <hr class="break break10">
                #if($pagination.equals("true"))
                    <div class="pagination-wrapper">
                        <ul class="pagination">
                            #if($currentPage > 1)
                                #set($prevPage = $currentPage - 1)
                                <li><a href="#" onclick="javascript: paginationHref($prevPage); return false;" aria-label="Previous"><span aria-hidden="true">Prevous</span></a></li>
                            #end
                            #foreach($i in [$currentPage..$paginateElipse])
                                #if($i > 1)
                                <li #if($i == $currentPage) class="active" #end><a onclick="javascript: paginationHref($i); return false;" href="#">$i</a></li>
                                #end
                            #end
                            #if($currentPage < $nextPage)
                                <li><a onclick="javascript: paginationHref($nextPage); return false;" href="#" aria-label="Next"><span aria-hidden="true">Next</span></a></li>
                            #end
                        </ul>
                    </div>
                #end
            </div>
        </div>
    </div>
</div>
#else
    #set($title = "No Result Found")
    <div class="tabled-heading">
        <h2>Sorry, not result found for your request. Please try again</h2>
    </div>
#end

<div class="modal fade" tabindex="-1" role="dialog" id="no-room-modal">
    <div class="modal-dialog modal-sm" role="document">
        <div class="modal-content">
            <div class="modal-body">
                <h2>Sold Out!</h2>
                <p>Sorry, selected room is currently not available or sold out. Please select another room and try again.<br />Thank you!</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div>